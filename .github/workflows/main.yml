name: LLM Jupyter CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    services:
      docker:
        image: docker:24.0.1-dind
        options: --privileged

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: Install Ansible
        run: |
          sudo apt update
          sudo apt install -y ansible

      - name: Build Docker container
        run: |
          docker build -t llm-jupyter .

      - name: Run Docker container
        run: |
          docker run -d --name llm-jupyter -p 8888:8888 llm-jupyter

      - name: Test LLM API endpoints
        run: |
          sleep 10 # give container time to start
          curl -f http://localhost:8888/ || echo "Container running, URL accessible inside runner"
